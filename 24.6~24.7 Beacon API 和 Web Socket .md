#### 一. Beacon API (信标)

> 为了把更完整的页面信息传给服务器，需要在**页面生命周期中尽量晚**的时候向服务器发送遥测或者数据分析！！

理想情况下，是在 unload 事件中向服务器发送数据，因为此时是用户要离开页面的时候，理应就不会生成别的有用信息了。**但是，** 在 unload 事件处理程序中创建的任何异步请求都会被浏览器取消！！so 异步的 XMLR 或者 fetch() 都不适合该任务。如果是要强制用同步发送 XMLR 的话，会产生用户体验问题，因为浏览器会等待 unload 事件处理程序完成而延迟导航到下一个页面！！！

**为了解决该问题，** W3C 就引入了 `Beacon API` ，这个 API 给 navigator 对象增加了一个 `sendBeacon()` 方法。该方法接收一个 URL 和 一个数据有效载荷参数！！发送的请求是 **POST请求**！！！

- 有效载荷参数可以是`ArrayBufferView` `Blob` `DOMString` `FormData` 的实例

- sendBeacon() 方法不是只能在页面生命周期末尾进行调用，任何时候都可以调用！！

- 浏览器保证在原始页面关闭后也能继续发送请求

- **缺点：** 状态码什么的都是不透明的



#### 二. Web Socket 套接字

> `Web Socket` 的目标是通过一个长时连接实现与服务器**全双工、双向**的通信！！



**（1）Web Socket 和 AJAX的比较：**

> `AJAX` 和 `Web Socket`都是进行前后端数据通信的工具。

**区别：**

- 一个是 `长轮询` ，一个是 `短轮询`

      - WebSocket 是长轮询，AJAX 是段轮询，举例说明：在一个电商平台上，商品的库存可能会
      发生变化，就需要服务器把数据返回，然后展示给用户；此时如果是长轮询，就是当后台的数据
      发生变化时，服务器自动向前端发出响应；如果是短轮询，就需要客户端不断的向服务器发送请求
     ，获取数据！！

- 生命周期不同

      - web socket 是长连接，会话一直保持
      - ajax 是短连接，发送端接收之后就会断开

- 使用范围

      - web socket 适用于前后端实时交互数据
      - ajax 是非实时交互数据

- 发起人

      - web socket 是服务器和客户端互相推送
      - ajax 是客户端发起！！

- 使用协议不同

      - ajax 使用的是 HTTP 协议
      - web socket 使用的是自定义协议

**（2）使用 web socket**

> 在 JS 中创建一个 Web Socket 实例时，一个 HTTP 请求会发送到服务器以初始化连接。接着，服务器响应后，连接使用 HTTP 的Upgrade 头部从 HTTP 协议转换到 Web Socket 协议。即 Web Socket 不能通过标准的 Web 服务器实现，而必须使用支持该协议的专有服务器！！ 

- URL方案有变化，从 http://    https://   ---->   ws://   wss://

前者是安全连接，后者是不安全连接！！

- 使用构造函数创建

      - let sk = new Web Socket( URL )
      - URL 必须是绝对路径！！

- 浏览器会在初始化创建 Web Socket 对象后立马创建连接

- readyState 属性表示当前状态

       - 0  ---- 正在连接
       - 1  ---- 连接已经建立
       - 2  ---- 连接正在关闭
       - 3  ---- 连接已经关闭

- 在连接生命周期中会触发的事件

        - open  连接成功时触发
        - error  连接发送错误时触发
        - close 连接关闭时触发 ，该事件有一个 event 参数!!

- 向服务器发送数据 send() 

        - 数据格式可以是字符串 、Arraybuffer 、Blob....

- 服务器向客户端发送/响应数据时，会触发 message 事件

        - 发送数据时，WebSocket 对象上会触发 message 事件
        - 该事件接收一个 enent 参数，可以通过 event.data 来获取载荷数据

- 可以在任何时候，调用 close() 方法关闭 Web Socket 连接




