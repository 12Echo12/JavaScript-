##### <1> 跨源资源共享 CORS

通过 XML 进行 Ajax 通信的一个限制就是`跨源安全策略`，默认情况下，XHR 只能访问与发起请求的页面在同一个域内的资源。

> `跨源资源共享 CORS` 的基本思路就是使用自定义的 HTTP 头部允许浏览器和服务器互相了解，以确实请求或响应该成功还是失败。

可以加一个额外的头部叫 `Origin` ，`Origin头部`包含发送请求的页面的源、协议、域名和端口，以便服务器确定是否为其提供响应！！

如果服务器决定响应请求，就要返回 Acess-Control-Alow-Origin 的头部，**XML原生对象支持 CORS**，所以这个行为会被自动触发！！

出于安全考虑，跨域的 XML 对象被加了以下额外的限制：

- 不能使用 setRequestHeader() 设置自定义头部

- 不能发送和接收 cookie

- getAllResponseHeaders() 始终返回空字符串

###### (1) 预检请求

> CORS 通过一种叫`预检请求` 的服务器验证机制，允许使用自定义头部，在要发送涉及上述某种高级选项的请求时，会先向服务器发送一个`预检请求`。该请求使用 `OPTIONS`方法发送！！！(p720)

预检请求发送后，结果会按响应在指定的时间缓存一段时间。即只有第一次发送这种类型的请求时，才会多发一次额外的 HTTP 预检请求！！

##### <2> 替代性跨源技术

###### (1) 图片探测

任何页面都可以跨域加载图片而不必担心限制！！！

> `图片探测` 一种可以动态创建图片的技术，可以使浏览器与服务器之间实现简单的、跨域的、单向的通信！！浏览器通过图片探测拿不到任何数据，但可以通过监听 onload 和 onerror 事件知道什么时候能够接收到响应!

![](C:\Users\lenovo\Desktop\哈哈\1837.jpg)

**注意：**

- 设置完 src 属性的值后请求开始了。

- **缺点：**
  
        - 只能发送 GET 请求
        - 无法获取服务器响应的内容(so是单向通信)

###### (2) JSONP  --- < script > 跨域请求 JS 资源

> `JSONP` ( JSON with padding) 的简写，是在 web 服务上流行的一种 JSON 变体，看起来和 JSON 一样，只是会被包在一个函数中调用！！

JSONP 格式包括两个部分：**回调和数据**，回调是在页面接收到相应之后会调用的函数！！数据就是响应的数据！！

JSON是通过动态创建 < script > 标签，并为其 src 属性指定要跨域的 URL 进行实现的，此时的 < script > 跟 < img > 相似，都可以不受限制的从其他域加载资源，**JSONP是有效的 JS ，所以 JSONP 响应在加

载完成后就会被立即执行** ！！

![](C:\Users\lenovo\Desktop\哈哈\1838.jpg)

- 由于 JSONP 可以直接访问响应的内容并使用，所以实现了双向通信

- **缺点：**
  
         - 如果遭到恶意插入代码，就必须删除整个 JSONP
         - 还无法确定 JSONP 请求是否失败
